captureBtn.onclick = async () => {
  if (!currentLocation) {
    alert('Menunggu lokasi...');
    return;
  }
  canvas.width = video.videoWidth;
  canvas.height = video.videoHeight;
  const ctx = canvas.getContext('2d');

  if (facingMode === 'user') {
    ctx.translate(canvas.width, 0);
    ctx.scale(-1, 1);
  }
  ctx.drawImage(video, 0, 0);
  if (facingMode === 'user') ctx.setTransform(1, 0, 0, 1, 0, 0);

  // ðŸŽ¨ Overlay lebih kecil & rapi untuk mobile
  const overlayHeight = canvas.height * 0.22; // lebih kecil
  const padding = 30;
  const lineHeight = 28;

  ctx.fillStyle = 'rgba(30, 30, 30, 0.85)';
  ctx.fillRect(0, canvas.height - overlayHeight, canvas.width, overlayHeight);

  ctx.fillStyle = '#4ec9b0';
  ctx.fillRect(0, canvas.height - overlayHeight, canvas.width, 3);

  // Judul lebih kecil
  ctx.font = 'bold 28px "Courier New"';
  ctx.fillStyle = '#4ec9b0';
  let y = canvas.height - overlayHeight + padding + 10;
  ctx.fillText('// JOGIIA RECORD', padding, y);

  // Info teks
  ctx.font = '22px "Courier New"';
  const now = new Date();
  const dateStr = now.toLocaleDateString('id-ID', { weekday: 'long', year: 'numeric', month: 'long', day: 'numeric' });
  const timeStr = now.toLocaleTimeString('id-ID');

  y += lineHeight;
  ctx.fillStyle = '#569cd6';
  ctx.fillText('waktu:', padding, y);
  ctx.fillStyle = '#ce9178';
  ctx.fillText(`"${timeStr}"`, padding + 130, y);

  y += lineHeight;
  ctx.fillStyle = '#569cd6';
  ctx.fillText('tanggal:', padding, y);
  ctx.fillStyle = '#ce9178';
  ctx.fillText(`"${dateStr}"`, padding + 130, y);

  y += lineHeight;
  ctx.fillStyle = '#569cd6';
  ctx.fillText('alamat:', padding, y);
  ctx.fillStyle = '#ce9178';
  ctx.fillText(`"${currentAddress}"`, padding + 130, y);

  y += lineHeight;
  ctx.fillStyle = '#569cd6';
  ctx.fillText('koordinat:', padding, y);
  ctx.fillStyle = '#ce9178';
  ctx.fillText(
    `"${currentLocation.lat.toFixed(6)}, ${currentLocation.lng.toFixed(6)}"`,
    padding + 130,
    y
  );

  // ðŸ§© Convert dan share ke WhatsApp
  canvas.toBlob(async (blob) => {
    const file = new File([blob], 'absensi.png', { type: 'image/png' });
    preview.innerHTML = `<img src="${URL.createObjectURL(blob)}">`;
    try {
      await navigator.share({
        files: [file],
        title: 'Absensi JOGIIA',
        text: 'Hasil absensi harian',
      });
      statusText.innerHTML = '<span class="success">Gambar berhasil dibagikan ke WhatsApp âœ“</span>';
    } catch {
      statusText.innerHTML = '<span class="success">Gambar berhasil diambil âœ“</span>';
    }
  }, 'image/png');
};
